<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: backup | Blog for Adam Fortuna]]></title>
  <link href="http://adamfortuna.com/tags/backup/atom.xml" rel="self"/>
  <link href="http://adamfortuna.com/"/>
  <updated>2014-05-31T14:28:11-04:00</updated>
  <id>http://adamfortuna.com/</id>
  <author>
    <name><![CDATA[Adam Fortuna]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Home Backup Like a Boss]]></title>
    <link href="http://adamfortuna.com/backup-like-a-boss/"/>
    <updated>2011-06-27T00:00:00-04:00</updated>
    <id>http://adamfortuna.com/backup-like-a-boss</id>
    <content type="html"><![CDATA[<p>After hearing about the &ldquo;FBI Raid on Marco Arment&rsquo;s servers&rdquo;:<a href="http://5by5.tv/buildanalyze/30,">http://5by5.tv/buildanalyze/30,</a> it got me interested in how he was doing backups. I&rsquo;ve been slowly tweaking my own backup procedures over the last few years &mdash; to the point of being borderline obsessed with having local backups. A few years ago in 2002, a failing SATA drive containing my windows partition and all my files left me high and dry and without just about any backups of anything. This was a time before &ldquo;Dropbox&rdquo;:<a href="http://db.tt/ueGBRCn">http://db.tt/ueGBRCn</a> and other synchronizing services had come along to make things easier, and I hadn&rsquo;t taken the step on my own to make backup a priority.</p>

<p>Two years ago when I was setting up my &ldquo;home media center&rdquo;:<a href="http://blog.adamfortuna.com/building-the-ultimate-media-center-part-3-bac/,">http://blog.adamfortuna.com/building-the-ultimate-media-center-part-3-bac/,</a> I took a first stab at serious backup. Since then I&rsquo;ve been gradually tweaking my system and trying new things. What follows is what worked for me.</p>

<p>h3. What&rsquo;s being backed up?</p>

<p>In this case I&rsquo;m talking about a lot of data, but split over a few discreet sections:</p>

<ul>
<li>Under 60 GB of photos, documents, code and general files.</li>
<li>About 150 GB of music, mostly ripped from my Mom&rsquo;s extensive CD collection when she was a DJ, plus my iTunes downloads.</li>
<li>About <em>(gulp)</em> 7 TB of movies. This includes a DVD rip of just every movie I&rsquo;ve ever bought.</li>
<li>3 Macs are being backed up with TimeMachine (Mac Mini and 2 MacBook Pros)</li>
</ul>


<p>!(right)http://adamfortuna.com/media/media_center/mini-small.png! I eased back to the steam-only version of NetFlix, so this is (luckily) the size of the movies folder no longer going up. Occasionally movies/TV are pruned down, so hopefully that&rsquo;ll be down to a &ldquo;manageable&rdquo; 5TB soon enough.</p>

<p>h3. What Hardware is this Using?</p>

<ul>
<li>Dedicated Seagate 1TB TimeMachine Hard Drive</li>
<li>&ldquo;4-bay USB/Firewire Drobo&rdquo;:<a href="http://www.amazon.com/Data-Robotics-FireWire-Storage-DR04DD10/dp/B001CZ9ZEE/ref=sr_1_1?ie=UTF8&amp;qid=1309218669&amp;sr=8-1&amp;tag=adamfortuna-20">http://www.amazon.com/Data-Robotics-FireWire-Storage-DR04DD10/dp/B001CZ9ZEE/ref=sr_1_1?ie=UTF8&amp;qid=1309218669&amp;sr=8-1&amp;tag=adamfortuna-20</a> with 4x2TB drives (~5.6TB) connected to the MacMini</li>
<li>&ldquo;4-bay MediaSonic Raid Enclosure&rdquo;:<a href="http://www.amazon.com/Mediasonic-eSATA-3-5-Inch-Enclosure-HFR2-SU3S2/dp/B003YFHEAC/ref=pd_sim_e_6?tag=adamfortuna-20">http://www.amazon.com/Mediasonic-eSATA-3-5-Inch-Enclosure-HFR2-SU3S2/dp/B003YFHEAC/ref=pd_sim_e_6?tag=adamfortuna-20</a> with 4x1TB (~3TB) connected to the MacMini</li>
<li>2 x Western Digital 3TB Drive connected to the Mac Mini (used exclusively for backups).</li>
</ul>


<p>p(center). !http://adamfortuna.com/media/media_center/drobo.png!&nbsp;&nbsp;&nbsp;&nbsp;!http://adamfortuna.com/media/media_center/mediasonic.png!</p>

<p>The Drobo and MediaSonic both can withstand a single drive failure with no data loss, which is an ideal first line of defense. I&rsquo;ve heard from many reviews that the performance of the Drobo is awful, but I haven&rsquo;t had too many issues. The initial load of data onto it is a long, slow, painful experience &mdash; and adding a new drive can require upwards of a day before you can use it, but for general use I haven&rsquo;t had any issues.</p>

<p>I&rsquo;d consider the MediaSonic enclosure as a lower priced alternative. The downside is needing 4 drives up front, but that&rsquo;s an issue you&rsquo;ll encounter with any RAID solution. You have the option of choosing the level of Raid you want, and formatting takes only a few minutes.</p>

<p>It&rsquo;s been a a year or two since I looked into hardware, but these have both lasted well without any data loss, and without any failed drives (so far).</p>

<p>h3. Software Makes it Happen</p>

<p>There&rsquo;s a few important pieces of software that keep things in sync. In my &ldquo;previous post&rdquo;:<a href="http://blog.adamfortuna.com/building-the-ultimate-media-center-part-3-bac/">http://blog.adamfortuna.com/building-the-ultimate-media-center-part-3-bac/</a> I was using mostly cron jobs &ndash; which works, but were a little rough around the edges. Since then I&rsquo;ve added a few more to the mix: !(right)http://adamfortuna.com/media/media_center/cronosync.png!</p>

<ul>
<li>TimeMachine is installed on all 3 Macs</li>
<li>&ldquo;Chronosync&rdquo;:<a href="http://www.econtechnologies.com/pages/cs/chrono_overview.html">http://www.econtechnologies.com/pages/cs/chrono_overview.html</a> installed everywhere</li>
<li>&ldquo;Backblaze&rdquo;:<a href="http://www.backblaze.com/partner/af1782">http://www.backblaze.com/partner/af1782</a> ($50/year) on Mac Mini</li>
<li>&ldquo;Dropbox&rdquo;:<a href="http://db.tt/ueGBRCn">http://db.tt/ueGBRCn</a> ($99/year) on laptop</li>
</ul>


<p>Now, if I had less than 100 GB of total data, I&rsquo;d just use Dropbox and call it a day. I&rsquo;d probably even enable the &ldquo;Packrat&rdquo; option for unlimited undo history. Even with the recent &ldquo;Dropbox authentication bug&rdquo;:<a href="http://blog.dropbox.com/?p=821">http://blog.dropbox.com/?p=821</a> it&rsquo;s still the best tool on the market. There are other ways to &ldquo;roll your own Dropbox&rdquo;:<a href="http://www.readwriteweb.com/cloud/2011/05/4-ways-to-build-your-own-dropbox.php">http://www.readwriteweb.com/cloud/2011/05/4-ways-to-build-your-own-dropbox.php</a> that may be worth checking out as well. Dropbox has the added bonus of having an API that other tools can interact with, that you wouldn&rsquo;t get from a home rolled solution.</p>

<p>p(center). !http://adamfortuna.com/media/screenshots/dropbox_referral.png!</p>

<p>It&rsquo;s also possible to increase the size of your Dropbox with referrals and other promotions they offer. My 50 GB box is up to 67.75 GB at the moment, just by taking advantage of their offer to increase the size with referrals. The additional amount of space for each referral is dependent on your pricing level, so you get more extra space for a referral when you&rsquo;re on the 50 GB plan than on the free plan.</p>

<p>Backblaze is a tool I haven&rsquo;t heard much fuss about, but for me it&rsquo;s been a reliable, cost efficient and effective tool in my backup strategy. The Mac app for Backblaze installs itself into your system preferences and is completely controlled from there. You can specify which folders/drives you want to keep backed up, and tweak the speed to upload.</p>

<p>p(center). !http://adamfortuna.com/media/screenshots/backblaze_persephone.png!</p>

<p>It took upwards of 3 months to upload 6 TB to Backblaze (which Brighthouse luckily didn&rsquo;t have any issues with). Since then it&rsquo;s stayed in sync a few days at any given time. The contents on the drive aren&rsquo;t in constant flux, so often it&rsquo;s updated within a few minutes. If you&rsquo;re on a slow connection, this might not be possible, but &ldquo;Road Runner Lightning&rdquo;:<a href="http://brighthouse.com/central-florida/shop/internet/road-runner-lightning">http://brighthouse.com/central-florida/shop/internet/road-runner-lightning</a> or FIOS will make the process a lot smoother.</p>

<p>h3. Bringing it All Together</p>

<p>The Drobo and Mediasonic devices serve as file storage for archived DVDs, and also store all music I&rsquo;ve ever ripped/downloaded. Both devices allow for a single drive failure without the loss of data &ndash; and advantage over the standalone Western Digital 3TB drives which if they fail, all data is lost.</p>

<p>h4. Time Machine</p>

<p>!(right)http://adamfortuna.com/media/media_center/timemachine.png! The 2 MacBook Pros and the Mac Mini are backed up constantly to Time Machine. Although not encouraged supported, you can plug a USB hard drive into an Airport Extreme and use it as a TimeMachine drive. From my experience, you can&rsquo;t do a first backup via USB then plug it in there either &mdash; you have to do all backups and restores while it is connected to the Airport Extreme (probably a paths thing).</p>

<p>h4. Music</p>

<p>Music on my main computer isn&rsquo;t backed up to TimeMachine. Usually I have about 100GB of music, podcasts and other videos from iTunes University which is instead backed up to the Mediasonic device. Chronosync does the work of keeping a nightly snapshot of my entire music folder on one of those drives. If I grab a new album off iTunes, or rip a CD, it&rsquo;ll be backed up that same day.</p>

<p>!(left)http://adamfortuna.com/media/media_center/itunes.png! The MediaSonic has 2 Music folders actually. It has an &ldquo;In Use&rdquo; folder and an &ldquo;Archive&rdquo; folder. The MacBook Pro music folder is mirrored to &ldquo;In Use&rdquo; &ndash; which is always a snapshot of what&rsquo;s currently on my laptop. Later, the Mac Mini does a sync to a second &ldquo;Archive&rdquo; folder. This may sound redundant, but that&rsquo;s because for much of the data it is.</p>

<p>The nice part is that if I delete something from my laptop, it&rsquo;ll also be deleted from the &ldquo;In Use&rdquo; copy, but the &ldquo;Archive&rdquo; folder will retain a copy. The goal of all this is that I can restore my music directly at anytime, not eat up space on the TimeMachine drive, and have an canonical archive for all music.</p>

<p>h4. In-House Backups</p>

<p>The MediaSonic drive is synced nightly to one of the WD 3TB drives. The sizes match, so it&rsquo;s a clean mirror. Chronosync handles the scheduling and syncing, keeping it easy to edit as well. 3 TB of data from the Drobo is backed up to the other MediaSonic Drive nightly as well. That leaves about 2.6 TB of data that&rsquo;s not duplicated in house, but is still available on Backblaze.</p>

<p>h3. The End Result</p>

<p>Any single hard drive or device can fail with a backup readily at hand. It&rsquo;s important to not only protect against a single hard drive failure but a single device failure. Having a device like a Drobo or a Raid helps with redundancy, but it&rsquo;s not a backup &mdash; if the device itself malfunctions or corrupts your data, you&rsquo;re out of luck. By having a in house backup of these, I still have access to anything important at a moments notice.</p>

<p>Setting up an offsite backup plan is annoying at first, but once it&rsquo;s in place it&rsquo;s a huge relief. At the moment I&rsquo;m very happy with both Backblaze and Dropbox, and plan to renew both. I haven&rsquo;t priced out how much it would cost to store 6 TB on S3, but I imagine it&rsquo;d be below $50 a year. The nice part of Backblaze is that they can mail you hard drives loaded with your data in the event of a failure &mdash; or you can just download specific files.</p>

<p>One obvious gap in my setup is offsite backups for my TimeMachine drive. These could be synced up with BackBlaze as well, but at the moment Backblaze requires all backed up drives to be physically connected to the machine with it installed.</p>

<p>h3. What&rsquo;s your Plan?</p>

<p>I&rsquo;m always interested to see what people are doing to backup large amounts of data like this. If you&rsquo;re backing up a large amount of files, or even a small amount, I&rsquo;d be interested in hearing what your strategy is!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[8 Awesome Uses for DropBox]]></title>
    <link href="http://adamfortuna.com/8-awesome-uses-for-dropbox/"/>
    <updated>2009-04-03T00:00:00-04:00</updated>
    <id>http://adamfortuna.com/8-awesome-uses-for-dropbox</id>
    <content type="html"><![CDATA[<p>Although only a very small part of my &ldquo;backup strategies&rdquo;:<a href="http://www.adamfortuna.com/2009/03/22/building-the-ultimate-media-center-part-3-backup/">http://www.adamfortuna.com/2009/03/22/building-the-ultimate-media-center-part-3-backup/</a> post dealt with &ldquo;Dropbox&rdquo;:<a href="https://www.getdropbox.com/referrals/NTY0ODEwOQ">https://www.getdropbox.com/referrals/NTY0ODEwOQ</a> , after using it for a second week I&rsquo;ve fallen for it. Sure, it&rsquo;s useful for syncing commonly used files between computers, and there&rsquo;s many more files that it would be useful to have revision history on, but there&rsquo;s more to it than just sharing files. With that in mind I&rsquo;ve been on a rampage to use it for simplifying my life as much as possible. Here&rsquo;s a few tricks I&rsquo;ve found that help make things easier.</p>

<p>h3. Backup Folders Not in Dropbox</p>

<p>Right now Dropbox installs itself into a pre-selected location, then everything in that folder is archived in Dropbox. Syncing outside of the Dropbox folder is on the todo list, but for now there&rsquo;s a workaround to do this. Create a symbolic link within the Dropbox folder pointing to the folder you want to archive. For instance, lets say within Dropbox you want your Documents folder. To do this you&rsquo;d create a sym link for this.</p>

<p><div>
  <pre><code class='bash'>ln- s ~/Documents/ ~/Dropbox/Documents</code></pre>
</div>
</p>

<p>Dropbox should start syncing right away, and will sync from here on out whenever. Anything that goes into your @~/Documents@ folder will be backed up. One very important thing to note is that if you delete something from the @~/Dropbox/Documents@ folder on another computer, it will be removed from your @~/Documents@ folder on the computer with the symlink, so keep that in mind.</p>

<p>h3. Syncing Adium Log Files Between Macs</p>

<p>So you&rsquo;re looking through chat logs for a conversation you know you had, but you can&rsquo;t seem to find it. Turns out it was on a a different computer. Has this ever happened to you? There&rsquo;s a convenient way of syncing Adium log files (or any other log files) with Dropbox. Adium doesn&rsquo;t allow you to change your Log directory, but there&rsquo;s no reason why you can&rsquo;t make the default location a smylink to somewhere else. I have a @~/Dropbox/Sync@ directory where I store any settings/items that I want to keep in Sync between computers, so this is the perfect place for it. I created a @~/Dropbox/Sync/chat@ folder, quit Adium and dragged my existing Adium logs folder into Dropbox (from /Users/adam/Library/Application Support/Adium 2.0/Users/Default/Logs). All you have to do is point a folder at your Dropbox and you&rsquo;re good to go! In my case, the command was:</p>

<p><div>
  <pre><code class='bash'>ln -s ~/Dropbox/Sync/chat/logs/ &amp;ldquo;/Users/adam/Library/Application Support/Adium 2.0/Users/Default/Logs&amp;rdquo;</code></pre>
</div>
</p>

<p>Just setup multiple computers with this same path and you should have a single repository for all your chat logs. I&rsquo;m not too sure how this works with conflict resolution, but unless you&rsquo;re chatting to the same person on multiple computers at the same time you should be good. If you&rsquo;ve tried that though, I&rsquo;d be interested to see how it works.</p>

<p>h3. Backup configuration</p>

<p>This was mentioned earlier, but having a shared space for your backup scripts makes life easier. Dropbox is amazing, but the Dropbox application does have the ability to delete files from your computer. Lets say the worst happens and they delete your account, causing your Dropbox to be deleted on all your computers- &ndash; would you mind? If you have your ~/Documents and other folders linked, this might be a huge blow to lose unless you&rsquo;re backing it up somewhere. This same doomsday scenerio could happen if someone hacks into your Dropbox account and removes your files from the web interface. You&rsquo;ll probably be able to restore them in that case, but then you&rsquo;re relying on Dropbox to fix the Dropbox problem. A more secure way of handling this might be to have a full copy of your Dropbox somewhere locally. With Dropbox maxing out around 55GB, making a full copy of this on some HD you have laying around isn&rsquo;t a bad idea. Automating the process and backing up your Dropbox nightly is even better though! So what would something like this look like.</p>

<p><div>
  <pre><code class='bash'>rsync -rpLtgoDE- -delete ~/Dropbox /Volumes/Drobo/Users/adam/current</code></pre>
</div>
</p>

<p>This rsync command will copy everything from my Dropbox to a local directory, in this case on a &ldquo;Drobo&rdquo;:<a href="http://www.drobo.com/">http://www.drobo.com/</a> . This follow all symlinks and copy the contents of them, rather than copying the symlinks themselves. Try saving this one line in a file, @backup.command@ . You should be able to run it by double clicking or from terminal. I store this file in @~/Dropbox/Sync/scripts/backup.command@ so it can be edited from anywhere.</p>

<p>h3. Version your crontab</p>

<p>You don&rsquo;t want to run that backup script manually everyday do you? To save time (and guarantee a good backup strategy), you&rsquo;ll want to have this automatically run. I&rsquo;ll recap real quick how to set this up. Just open up terminal on the computer you&rsquo;ll be automating the backup. You can call things on a scheduling using &ldquo;cron&rdquo;:<a href="http://en.wikipedia.org/wiki/Cron">http://en.wikipedia.org/wiki/Cron</a> , which can be opened by entering @crontab- e@ . I&rsquo;ve decided to run the above script every day, and backup my list of cron jobs every day.</p>

<p><div>
  <pre><code class='bash'>@daily crontab -l &gt; ~/Dropbox/Sync/scripts/crontab.txt 30 3 * sh ~/Dropbox/Sync/scripts/backup.command</code></pre>
</div>
</p>

<p>The first line will save the crontab contents in the @ ~/Dropbox/Sync/scripts/crontab.txt@ file. The @daily parts means this&rsquo;ll happen every night at midnight. The second line is scheduled to run every night at 3:30am as well, but usually takes a little longer. Rsync isn&rsquo;t the fastest in the world, but it&rsquo;ll get the job done- &ndash; usually in under a minute for me.</p>

<p>h3. Sync Your &ldquo;Things&rdquo;:<a href="http://culturedcode.com/things/">http://culturedcode.com/things/</a> Tasks</p>

<p>For a while during the beta, Things was my GTD/todo list of choice. The interface has a level of polish that few apps obtain &mdash; and even fewer in the GTD relm where complexity is the norm. One downside of Things is that it doesn&rsquo;t use MobileMe syncing like OmniFocus, it&rsquo;s competitor. You can get around this and use your Dropbox for syncing in the same way as Adium though. Just close Things and move your Things database files folder to your Dropbox on one computer &mdash; I threw it in ~/Dropbox/Sync/Things. Create a symlink from where it used to be to the new Dropbox location and you should be good! You&rsquo;ll need to do this same step on your other computer(s), but without the copying the file to Dropbox step. This does have a caviat though &mdash; you must close Things each time you switch computers. Unlike Adium, when there&rsquo;s a conflict, well it&rsquo;s very bad. Your Things database is a single XML file that cannot be merged. So be sure to always close Things when you switch computers to be safe. If anything goes wrong though, you can always sign into the Dropbox web interface and roll the file back. Or you could just use &ldquo;Remember the Milk&rdquo;:<a href="http://www.rememberthemilk.com">http://www.rememberthemilk.com</a> and not have to worry about syncing.</p>

<p>h3. Host a Local Wiki</p>

<p>&ldquo;TiddlyWiki&rdquo;:<a href="http://www.tiddlywiki.com/">http://www.tiddlywiki.com/</a> is a Wiki unlike any other I&rsquo;ve heard of. It has all the storage characteristics of a normal wiki, but exists as a single html file that edits. Just copy it to your Dropbox, open it up in Firefox (you are using FireFox right?) and start making changes. Upon saving it&rsquo;ll update the file in Dropbox. As with a few other tips, you probably shouldn&rsquo;t have TiddlyWiki open on another when saving. If you&rsquo;ve jumped on the TiddlyWiki bandwagon but you&rsquo;re using a USB drive to transfer your Wiki around, Dropbox is a simple upgrade to save some time.</p>

<p>h3. Sync your Passwords</p>

<p>I don&rsquo;t personally use any sort of password manager, but LifeHacker has a good article on &ldquo;How to Use Dropbox as the Ultimate Password Syncer&rdquo;:<a href="http://lifehacker.com/5063176/how-to-use-dropbox-as-the-ultimate-password-syncer">http://lifehacker.com/5063176/how-to-use-dropbox-as-the-ultimate-password-syncer</a> . According to the Lifehacker article, changes are pulled in right away, even when using multiple computers. This is because 1Password, the password manager used in the article, stores your data in lots of little files, making it ideal for minimal conflicts.</p>

<p>h3. Sync your Firefox Bookmarks</p>

<p>Firefox bookmarks are another one that seem like a no-brainer to use Dropbox for. There are so many different bookmark sync services out there that can do this, but why use another service when you&rsquo;re already using Dropbox? The basics for this are just copying your firefox profile to Dropbox, then starting Firefox with the- p option which allows you to specify a profile path. Just follow the directions on how to &ldquo;Sync Firefox Bookmarks&rdquo;:<a href="http://wiki.getdropbox.com/TipsAndTricks/SyncFirefoxBookmarks">http://wiki.getdropbox.com/TipsAndTricks/SyncFirefoxBookmarks</a> from the Dropbox Wiki and you should be good. This tip doesn&rsquo;t use symlinks like a number of others, making it a little easier to setup.</p>

<p>h3. Join Dropbox</p>

<p>Dropbox provides 2gb of storage out of the gate, but if you signup with a &ldquo;referral link&rdquo;:<a href="https://www.getdropbox.com/referrals/NTY0ODEwOQ">https://www.getdropbox.com/referrals/NTY0ODEwOQ</a> , you&rsquo;ll get an extra 250mb of space (and I&rsquo;ll get an extra 250mb too)! The desktop app works on Mac, PC and Linux with a very simple install on all of them. If you join up and have any other tips or tricks, feel free to share them here!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Building the Ultimate Media Center, Part 3: Backup]]></title>
    <link href="http://adamfortuna.com/building-the-ultimate-media-center-part-3-bac/"/>
    <updated>2009-03-22T00:00:00-04:00</updated>
    <id>http://adamfortuna.com/building-the-ultimate-media-center-part-3-bac</id>
    <content type="html"><![CDATA[<p>Describing what I&rsquo;ve been working on so far as a media center may not be quite sufficient. Now a days term &ldquo;home server&rdquo; seems to do it a bit more justice, and if a home computer is on full time you&rsquo;ll certainly want to get the most out of it. If you&rsquo;ve ever wanted to do backups within your home, you might&rsquo;ve looked into &ldquo;Windows Home Server&rdquo;:<a href="http://www.microsoft.com/windows/products/winfamily/windowshomeserver/default.mspx">http://www.microsoft.com/windows/products/winfamily/windowshomeserver/default.mspx</a> or Apples &ldquo;Time Capsule&rdquo;:<a href="http://www.apple.com/timecapsule/">http://www.apple.com/timecapsule/</a> / &ldquo;Time Machine&rdquo;:<a href="http://www.apple.com/macosx/features/timemachine.html">http://www.apple.com/macosx/features/timemachine.html</a> setups, but neither is quite what I was looking for. First off, I don&rsquo;t really want a Windows box in (mostly) mac home, so that&rsquo;s out. Time Machine alone doesn&rsquo;t do everything I have in mind, although it does play an important part. I&rsquo;ve had a lot of backup plans in the past, but none were quite &ldquo;perfect&rdquo;, which got me wondering what a perfect backup plan would look like.</p>

<p>h3. What do you want in backup plan?</p>

<p>Just like in creating software, when setting up a backup plan it&rsquo;s important to know your requirements ahead of time. Otherwise what are you working towards? So what do I want this backup plan to be able to do&hellip;</p>

<ul>
<li>Make it so that there is no single point of failure for any important data</li>
<li>Have on site and off site backups of everything</li>
<li>Backup and sync core data between macs (settings, address book, calendar, keychain, etc)</li>
<li>Some kind revision system for all text files. Something like git or svn where you can rollback changes</li>
<li>A local redundant hard drive array to guarantee no data loss if a single drive fails</li>
<li>Backup all core documents on various time intervals (daily, weekly, monthly). That way if I mess up a file and don&rsquo;t realize it for a week I&rsquo;ll be able to grab the version a month ago.</li>
</ul>


<p>h3. Settings, Calendars, Address Book and more</p>

<p>If you have multiple Macs &ldquo;Mobile Me&rdquo;:<a href="http://www.apple.com/mobileme/">http://www.apple.com/mobileme/</a> is a good choice for easy syncing between macs. The system has had a lot of problems, and continues to struggle with performance. iDisk, the webdav interface to your MobileMe account is <em>painfully</em> slow, and continues to be. Just cleaning out a few hundred empty folders was enough to stall it earlier. The online image gallery MobileMe has is one of the better one&rsquo;s seen, and if you use iPhoto it&rsquo;s a convenient photo storage location. Just so that all my calendars and contacts aren&rsquo;t confined to a single system (the Mac ecosystem), I use &ldquo;Spanning Sync&rdquo;:<a href="http://spanningsync.com/">http://spanningsync.com/</a> to keep my Google Calendars and Google Contacts in check with iCal and Address Book. My girlfriend and I share calendars with each other on Google, and this way any changes she makes show up on my iCal, and any I make on iCal show up on hers. Also, whenever I get Google Calendar invites to my email address, they show up on Google Calendar then get syncd back to iCal. 2 way syncing is the way to go!</p>

<p>h3. Complete Backups With Time Machine</p>

<p>Time Capsule is powerful and dead simple for full system backups. The way it works is simple: all macs on a network will have Time Machine (a program that ships with Leopard) enabled and set to use the Time Capsule hardware. Every hour or so, changes made to the core and specific folders will be pushed from the client computer (in this case my laptop) to the Time Capsule. You can specify which folders to watch for this as well. You might not want it watching your Downloads folder or others that are similarly volatile, but that&rsquo;s easy to change. The first time you back up everything to Time Capsule you&rsquo;ll want a hardline to it rather than doing it over a home network (even if it&rsquo;s wireless N). Transferring your entire computer initially could take a full day if not, so be sure to plug it in. The hourly backups after that work wirelessly though, as they are much much smaller. Apple&rsquo;s Airport Extreme has the ability to add a remote hard drive which can serve as a Time Machine drive as well. The nice part about this is that you can use an old external hard drive you have, or choose any drive out there. Leopard didn&rsquo;t originally allow you to sync with drives like this, but in one of the recent updates it was enabled. For me, after the initial backup the incremental backups are very quick if not much has changed. Running TimeMachine for the first time is a trippy experience. You &ldquo;go back in time&rdquo; to the point where you want to see a file, then you can restore it. This covers a few of the requirements such as versioned files locally and full system backups with the ability to restore on any Mac.</p>

<p>h3. Backups to a local RAID (or Drobo)</p>

<p>Finally, the first step that the Media Center can help with. Whether you go with RAID, a &ldquo;Drobo&rdquo;:<a href="http://www.drobo.com/">http://www.drobo.com/</a> or something else, the backup procedure to it will be about the same. The easiest way I&rsquo;ve found to do backups to this is with rsync and crontab. Here&rsquo;s how it works: Your media server will have a series of scripts setup to run daily, weekly and monthly. These scripts will do all the heavy lifting of the backup &ndash; grabbing files from every computer on your network you want to backup and moving them to the redundant array. So firstoff the media server should be setup to backup everything from the computers on the network. That&rsquo;s easy actually. On each computer you want to back files up from, go into System Preferences > Sharing and enable &ldquo;Remote Login&rdquo;. This will allow the media center to ssh into each laptop. Backing up using rsync can be done by mapping drives in Finder and using those paths (/Volumes/adam), or by using SSH. With SSH you don&rsquo;t have to map the drive beforehand, so it is the preferred method. On the media center, open up a text file. This will contain everything you want to copy from your client computers, and the path (on your media center) that you want to store them in.</p>

<p><div>
  <pre><code class='bash'>rsync -aE &amp;mdash;delete adam@link.local:Desktop /Volumes/Drobo/Users/adam/current
rsync -aE &amp;mdash;delete adam@link.local:Documents /Volumes/Drobo/Users/adam/current
rsync -aE &amp;mdash;delete adam@link.local:Movies /Volumes/Drobo/Users/adam/current
rsync -aE &amp;mdash;delete adam@link.local:Pictures /Volumes/Drobo/Users/adam/current
rsync -aE &amp;mdash;delete adam@link.local:Processing /Volumes/Drobo/Users/adam/current
rsync -aE &amp;mdash;delete adam@link.local:Sites /Volumes/Drobo/Users/adam/current</code></pre>
</div>
</p>

<p>Note that the destination (the 2nd path) is the same. That&rsquo;s just because it&rsquo;ll actually store the documents folder in &ldquo;/Volumes/Drobo/Users/adam/current/Documents&rdquo;. The- a option specifies &ldquo;Archive&rdquo;, which is actually shorthand for a few other options. It will recusively copy all directories, copy symlinks, preserve file permissions, preserve owner and groups, preserve file times preserve special files. The -E flag preserves executability, while --delete deletes extraneous files - like those that were deleted. Save this file somewhere on the media center as a .command file. I kept it simple &ndash; backup.command. You should be able to run this script by just double clicking on it now. But there is a one major problem &mdash; authentication.</p>

<p>h3. Setting up SSH keys</p>

<p>By setting up SSH Keys you can automate the authentication from the Media Server to any clients you want to backup. The way you do this is very easy. On the Media server, run the command @ ssh-keygen- t dsa@ . Go with the defaults, but choose a passphrase you can remember. Copy this file from the Media server to the computer you want to backup FROM. Since you should already have SSH setup, something like this should do the job.</p>

<p><div>
  <pre><code class='bash'>link:~ adam$ scp ~/.ssh/id_dsa.pub adam@link.local:~/.ssh/authorized_keys2@</code></pre>
</div>
</p>

<p>If you already have an @authorized_keys2@ file, you&rsquo;ll want to add the contents of @id_dsa.pub@ to it instead of replacing it. After that&rsquo;s updated, try SSHing to that client from the Media Server. You should get prompted for the passphrase (a mac prompt, not a terminal prompt). After you enter it and save it for later you should be able to SSH without any password going forward.</p>

<p>h3. Setting it up to run automatically</p>

<p>Not worrying about backups is the whole point of this entire system, so running it automatically is essential. Luckily Unix systems have an easy way of doing this using cron jobs. To open up the list of cron jobs, just enter @crontab -e@ in a terminal window. This will open up the cron file using VI. Editing in VI can be a bit annoying without knowing the comamnds. To edit it you don&rsquo;t need to know much VI though. Just hit &ldquo;i&rdquo; to go into insert mode, where you can start typing. Each line you enter is a single scheduled cron job with a very specific format. For example, here&rsquo;s a line to run a script every day at 3:30am:</p>

<p><div>
  <pre><code class='bash'>30 3 * sh ~/Dropbox/scripts/backup.command</code></pre>
</div>
</p>

<p>The &ldquo;30 3 *&rdquo; part deals with when it should be run, while the part after that is what to run. Here&rsquo;s what those first 5 options translate to:</p>

<ul>
<li>30- minute to run job on</li>
<li>3 &ndash; hour to run job on</li>
<li><ul>
<li><ul>
<li>Day of the month to run job on</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>Which month to run job on</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>Which day of the week to run the job on</li>
</ul>
</li>
</ul>
</li>
</ul>


<p>It&rsquo;s a bit tricky to remember at first, but it&rsquo;s a very simple scheduling system. For example, if you want to run something on sunday (the 0th day of the week) at 5:30 am, the parameters would be &ldquo;30 5 0 &hellip;&rdquo;. Here&rsquo;s my full crontab that I&rsquo;m using (some of these scripts I haven&rsquo;t discussed yet, but we&rsquo;ll get to later).</p>

<p><div>
  <pre><code class='bash'>30 3 * sh ~/Dropbox/scripts/backup.command
00 5 1 sh ~/Dropbox/scripts/weekly.command
00 6 1 sh ~/Dropbox/scripts/monthly.command
30 6 1 sh ~/Dropbox/scripts/external.backup.command</code></pre>
</div>
</p>

<p>The weekly and monthly scripts will just take a snapshot every month rather than every day. Nothing much to those scripts &mdash; just removing the last update and copying a snapshot. The monthly script is exactly the same but with &ldquo;weekly&rdquo; changed to &ldquo;monthly&rdquo;. The point of this is that if anything big goes wrong, you&rsquo;ll have a backup locally of the original.</p>

<p><div>
  <pre><code class='bash'>rm -rf /Volumes/Drobo/Users/adam/weekly/ cp- pR /Volumes/Drobo/Users/adam/current/ /Volumes/Drobo/Users/adam/weekly/</code></pre>
</div>
</p>

<p>h3. Versioned changes with Dropbox</p>

<p>&ldquo;DropBox&rdquo;:<a href="https://www.getdropbox.com/referrals/NTY0ODEwOQ">https://www.getdropbox.com/referrals/NTY0ODEwOQ</a> is probably my favorite part of all this. After signing up for DropBox, you install a small program on each computer you want to use it with. It&rsquo;ll create a DropBox folder at a location you pick (I went with the default ~/Dropbox). Anything you add to this folder will get synced up to the Dropbox service. What&rsquo;s extra-useful about this is that all files will be versioned. I&rsquo;m storing my Documents and Sites folders in here and backing up daily. Even if I haven&rsquo;t committed site changes for something I&rsquo;m working on, it&rsquo;ll still have a daily revision of changes. I have a few other commands in my backup.command file that copy things over to a DropBox folder on the Media Server.</p>

<p><div>
  <pre><code class='bash'>rsync -aE &amp;mdash;delete /Volumes/Drobo/Users/adam/current/Documents ~/Dropbox
rsync- aE &amp;mdash;delete /Volumes/Drobo/Users/adam/current/Sites ~/Dropbox</code></pre>
</div>
</p>

<p>One really nice part about Dropbox&rsquo;s desktop client is that you can limit the upload speed. With RoadRunner my upstream is capped to about 70k/s when it&rsquo;s in a good mood, and maxing it out will usually slow down any downloads. Being able to cap it to 10k/s is very useful in my situation.</p>

<p>h3. Backing up your backup scripts</p>

<p>You&rsquo;ll notice that my backup scripts where in my Dropbox: @~/Dropbox/scripts/backup.command@ . Not only does this mean that you&rsquo;ve backed up your scripts (always a good practice), but you can change your backup procedure from anywhere you can access Dropbox! This is so simple it&rsquo;s one of the most effortless things to setup. You can also copy the contents of your crontab file Add this line to your crontab: @@daily crontab- l > ~/Dropbox/crontab.txt@ &ldquo;@daily&rdquo; is shorthand for &ldquo;everyday at midnight&rdquo;. This is a nice way of archiving any changes you make to your crontab. With the other backup scripts you can make changes on any computer and the Media Center will pull them in thanks to DropBox. But for the crontab you&rsquo;ll actually want to make changes directly to the Media Center using the &ldquo;crontab -e&rdquo; command.</p>

<p>h3. External backups of everything else</p>

<p>&ldquo;DropBox&rdquo;:<a href="https://www.getdropbox.com/referrals/NTY0ODEwOQ">https://www.getdropbox.com/referrals/NTY0ODEwOQ</a> is free up to 2GB making it excellent for documents, but not very realistic for media. They do offer a plan up to 50GB for $99/yr, which blows MobileMe&rsquo;s 20GB plan out of the water. Most the use I get from MobileMe is in syncing computers though, so I&rsquo;ll keep it going for that. For now I&rsquo;ll stick with MobileMe for my larger media backup as well, although I can tell you now I&rsquo;m not exactly happy about it. One of the downsides of MobileMe is that it doesn&rsquo;t automatically mount itself on startup. Normally you have to click on it in Finder to mount the drive. Only then it&rsquo;ll show in &ldquo;/Volumes&rdquo;. You can open up Script Editor and create a small app to do this though. Just copy this and change it to use your username and password. @ tell application &ldquo;Finder&rdquo; mount volume &ldquo;<a href="http://idisk.mac.com/myusername/">http://idisk.mac.com/myusername/</a>&rdquo; as user name &ldquo;myusername&rdquo; with password &ldquo;mypassword&rdquo; end tell @ Save it as file format &ldquo;Application&rdquo; with &ldquo;Run Only&rdquo; checked, but don&rsquo;t check &ldquo;Stay Open&rdquo; or &ldquo;Startup Screen&rdquo;. Save this application somewhere then add it to your startup items. The last part is setting up the &ldquo;remote.command&rdquo; script listed earlier. This will do all the work of copying everything remotely, with the exception of whatever uses Dropbox.</p>

<p><div>
  <pre><code class='bash'>rsync -aE &amp;mdash;delete /Volumes/Drobo/Users/adam/current/Documents /Volumes/myusername
rsync -aE &amp;mdash;delete /Volumes/Drobo/Users/adam/current/Backup /Volumes/myusername
rsync -aE &amp;mdash;delete /Volumes/Drobo/Users/adam/current/Desktop /Volumes/myusername/Documents
rsync -aE &amp;mdash;delete /Volumes/Drobo/Users/adam/current/Movies /Volumes/myusername
rsync -aE &amp;mdash;delete /Volumes/Drobo/Users/adam/current/Pictures /Volumes/myusername
rsync -aE &amp;mdash;delete /Volumes/Drobo/Users/adam/current/Sites /Volumes/myusername
rsync -aE &amp;mdash;delete /Volumes/Drobo/Books /Volumes/myusername/Documents</code></pre>
</div>
</p>

<p>This just runs weekly everything here doesn&rsquo;t change that much. The Pictures directly is the main one that&rsquo;ll be updated, as it&rsquo;s a single iPhoto file that changes often.</p>

<p>h3. Woh, that&rsquo;s a lot. Did we miss anything?</p>

<p>Well, two things were skipped- &ndash; Music and Videos. I have a decent sized music collection, and I tend to archive my DVDs for use with Plex. Backing up 2TB of data remotely when you&rsquo;re limited to 70k/s upload speeds isn&rsquo;t exactly possible. What I am doing is storing all my media on a Drobo which protects it against a single hard drive failure (maybe more, depending on when the failures occur). My TimeMachine drive is actually a 500gb drive split &ndash; 200 for Time Machine and the rest for media backup. Every night the Media Center pushes all music from the Drobo onto this external drive. At least that way all my music is protected in case the Drobo itself fails. There&rsquo;s no external backup for music, but I&rsquo;m OK with that. If I was a little more paranoid I might archive weekly and leave the drive at work or something, but that&rsquo;s where I draw the line. That leaves one gaping hole &ndash; the movie collection this system was for in the first place! For now I&rsquo;m content with being protected against a single HD failure with the Drobo, but if anyone has any suggestions on how to back this up I&rsquo;m all ears. Also if you think of anything else I missed, or just something I could do better then please leave a comment!</p>

<p>h3. Did this help?</p>

<p>If this article helped you, please sign up for &ldquo;DropBox&rdquo;:<a href="https://www.getdropbox.com/referrals/NTY0ODEwOQ">https://www.getdropbox.com/referrals/NTY0ODEwOQ</a> ! DropBox was in beta for a while, but now it&rsquo;s open and anyone can sign up. You get 2GB of space just for signing up. They have the added bonus of increasing your space by 250mb for everyone you refer (up to 5GB total), so by signing up you&rsquo;ll give me more space to experiment with. It&rsquo;s easily the best backup service I&rsquo;ve used, so I&rsquo;m looking forward to seeing how it grows.</p>
]]></content>
  </entry>
  
</feed>
